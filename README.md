# DonMarket

–ü–ª–∞–≥–∏–Ω –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ –¥–æ–Ω–∞—Ç-—É—Å–ª—É–≥ –¥–ª—è Minecraft Paper 1.16.5 (Java 17).

## –°–±–æ—Ä–∫–∞

```bash
mvn clean package
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: `target/DonMarket-1.0-SNAPSHOT.jar`

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `DonMarket-1.0-SNAPSHOT.jar` –≤ –ø–∞–ø–∫—É `plugins/` —Å–µ—Ä–≤–µ—Ä–∞.
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä.
3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `donmarket.db` (SQLite) —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `plugins/DonMarket/`.

## –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∞–≤–æ |
|---------|----------|-------|
| `/dm` | –û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –î–æ–Ω –ú–∞—Ä–∫–µ—Ç | `donmarket.use` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: true) |

## –ü—Ä–∞–≤–∞

| –ü—Ä–∞–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-------|----------|--------------|
| `donmarket.use` | –î–æ—Å—Ç—É–ø –∫ –º–∞—Ä–∫–µ—Ç—É | true |
| `donmarket.admin` | –ê–¥–º–∏–Ω-–ø—Ä–∞–≤–∞ | op |

## üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞

- **–ú–æ–Ω–µ—Ç—ã ($)** ‚Äî —á–µ—Ä–µ–∑ Vault (EssentialsX, CMI –∏ —Ç.–¥.)
- **–¢–æ–∫–µ–Ω—ã / –ü–æ–∏–Ω—Ç—ã (‚ö°)** ‚Äî —á–µ—Ä–µ–∑ **PlayerPoints** –ø–ª–∞–≥–∏–Ω

–ï—Å–ª–∏ Vault –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç.
–ï—Å–ª–∏ PlayerPoints –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å —Ç–æ–∫–µ–Ω–æ–≤ (SQLite).

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
| –ü–ª–∞–≥–∏–Ω | –û–±—è–∑–∞—Ç–µ–ª–µ–Ω? | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-------------|------------|
| Vault | –ù–µ—Ç (soft) | –ú–æ–Ω–µ—Ç—ã ($) |
| PlayerPoints | –ù–µ—Ç (soft) | –¢–æ–∫–µ–Ω—ã (‚ö°) |

### –¢–æ–∫–µ–Ω—ã (‚ö° PlayerPoints)
–¢–æ–∫–µ–Ω—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–ª–∞–≥–∏–Ω **PlayerPoints**.
–ï—Å–ª–∏ PlayerPoints –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ SQLite (`player_balances.tokens`).

## –ó–∞–º–µ–Ω–∞ SQLite –Ω–∞ MySQL

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å `MySQLStorage implements Storage` –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `SQLiteStorage`.
2. –ó–∞–º–µ–Ω–∏—Ç–µ `DriverManager.getConnection(...)` –Ω–∞ MySQL URL:
   ```java
   connection = DriverManager.getConnection(
       "jdbc:mysql://host:3306/dbname?useSSL=false", "user", "password");
   ```
3. –ó–∞–º–µ–Ω–∏—Ç–µ `INSERT OR IGNORE` –Ω–∞ `INSERT IGNORE` (MySQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å).
4. –ó–∞–º–µ–Ω–∏—Ç–µ `INTEGER PRIMARY KEY AUTOINCREMENT` –Ω–∞ `INT PRIMARY KEY AUTO_INCREMENT`.
5. –í `DonMarketPlugin.onEnable()` –∑–∞–º–µ–Ω–∏—Ç–µ `new SQLiteStorage(...)` –Ω–∞ `new MySQLStorage(...)`.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
ru.fkdev.donmarket
‚îú‚îÄ‚îÄ DonMarketPlugin          ‚Äî –≥–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø–ª–∞–≥–∏–Ω–∞
‚îú‚îÄ‚îÄ command/
‚îÇ   ‚îî‚îÄ‚îÄ DmCommand            ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ /dm
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ ConfigManager        ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –¥–æ—Å—Ç—É–ø –∫ config.yml
‚îú‚îÄ‚îÄ economy/
‚îÇ   ‚îî‚îÄ‚îÄ EconomyManager       ‚Äî Vault + PlayerPoints + fallback
‚îú‚îÄ‚îÄ gui/
‚îÇ   ‚îú‚îÄ‚îÄ GuiBase              ‚Äî –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å GUI
‚îÇ   ‚îú‚îÄ‚îÄ DonMarketMainGui     ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (45 —Å–ª–æ—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ PlayerOrdersGui      ‚Äî –∑–∞–∫–∞–∑—ã –∏–≥—Ä–æ–∫–æ–≤ (54 —Å–ª–æ—Ç–∞)
‚îÇ   ‚îú‚îÄ‚îÄ MyOffersGui          ‚Äî –º–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (54 —Å–ª–æ—Ç–∞)
‚îÇ   ‚îú‚îÄ‚îÄ CreateOrderMainGui   ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (45 —Å–ª–æ—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ CreateOrderPrivilegesGui ‚Äî –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ (45 —Å–ª–æ—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ CreateOrderCasesGui  ‚Äî –∫–µ–π—Å—ã (45 —Å–ª–æ—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ CreateOrderTokensGui ‚Äî —Ç–æ–∫–µ–Ω—ã (45 —Å–ª–æ—Ç–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ CreateOrderOtherGui  ‚Äî —Ä–∞–∑–Ω–æ–µ (45 —Å–ª–æ—Ç–æ–≤)
‚îú‚îÄ‚îÄ listener/
‚îÇ   ‚îú‚îÄ‚îÄ GuiListener          ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ GUI
‚îÇ   ‚îî‚îÄ‚îÄ ChatInputListener    ‚Äî –≤–≤–æ–¥ —Å—É–º–º—ã —á–µ—Ä–µ–∑ —á–∞—Ç
‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îú‚îÄ‚îÄ Category             ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ MarketOrder          ‚Äî —Å—É—â–Ω–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ OrderStatus          ‚Äî —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ PlayerUIState        ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ UI –∏–≥—Ä–æ–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ SortMode             ‚Äî —Ä–µ–∂–∏–º—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ Storage              ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îî‚îÄ‚îÄ SQLiteStorage        ‚Äî SQLite —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îî‚îÄ‚îÄ util/
    ‚îú‚îÄ‚îÄ ColorUtil            ‚Äî HEX —Ü–≤–µ—Ç–∞, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ ItemBuilder          ‚Äî –±–∏–ª–¥–µ—Ä ItemStack
    ‚îî‚îÄ‚îÄ SkullUtil            ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –≥–æ–ª–æ–≤ —Å —Ç–µ–∫—Å—Ç—É—Ä–∞–º–∏
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –º–µ–Ω—é, —Å–æ–æ–±—â–µ–Ω–∏—è, —Ç–æ–≤–∞—Ä—ã, –Ω–∞–≥—Ä–∞–¥—ã –∏ –∑–≤—É–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `config.yml`.
–§–∞–π–ª —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`settings`)
- **order-expire-hours** ‚Äî —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –∑–∞–∫–∞–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 24 —á–∞—Å–∞)
- **chat-input-timeout-seconds** ‚Äî —Ç–∞–π–º–∞—É—Ç –≤–≤–æ–¥–∞ —Å—É–º–º—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 60 —Å–µ–∫)
- **coins-per-point** ‚Äî –∫—É—Ä—Å: —Å–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç –∑–∞ 1 –ø–æ–∏–Ω—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10)
- **cancel-words** ‚Äî —Å–ª–æ–≤–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã –≤–≤–æ–¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `cancel,–æ—Ç–º–µ–Ω–∞`)

### –ù–∞–≥—Ä–∞–¥—ã (`rewards`)
–ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ `rewards.on-order-filled`.
–ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã: `{player}`, `{owner}`, `{product}`, `{duration}`, `{order_id}`.

```yaml
rewards:
  on-order-filled:
    - "lp user {owner} parent addtemp {product} {duration}"
```
